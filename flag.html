<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Métadonnées Projet -->
    <meta name="author" content="Xavier (WolwX)">
    <meta name="description" content="Flag - Version Standalone v1.2 - Sensibilisation sÃ©curitÃ© informatique">
    <meta name="keywords" content="sécurité informatique, sensibilisation, BSoD, verrouillage, formation">
    <meta name="version" content="1.2-standalone">
    <meta name="release-date" content="2025-11-05">
    <meta name="repository" content="https://github.com/WolwX/Flag">
    <meta name="contact" content="wolwx@hotmail.com">
    <meta name="copyright" content="© 2025 Xavier (WolwX). All Rights Reserved.">
    <meta name="license" content="Proprietary - Tous droits réservés">
    
    <title>Erreur Critique de Sécurité</title>
    <style>
body{margin:0;padding:0;background-color:#0078D7;color:white;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;min-height:100vh;width:100vw;display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start;overflow:hidden;box-sizing:border-box}.config-panel{position:fixed;top:0;left:0;width:100vw;background:#e3f0ff;color:#222;padding:0.3em 0 0.3em 1vw;font-size:0.85em;display:flex;align-items:stretch;border-bottom:1px solid #b3d1f7;box-sizing:border-box;margin-bottom:0;z-index:1000;box-shadow:0 2px 12px rgba(0,0,0,0.1);height:52px}.config-bar-grid{display:flex;flex-direction:row;align-items:center;justify-content:space-around;gap:0.5em;width:calc(100% - 130px);height:100%;position:relative}.config-group{display:flex;flex-direction:column;align-items:center;justify-content:center;min-width:100px;max-width:150px;flex:1 1 0;padding:0;box-sizing:border-box;gap:0.2em}.config-label{font-weight:600;font-size:0.8em;display:flex;align-items:center;justify-content:center;white-space:nowrap;flex-shrink:0;width:100%;text-align:center}.config-input{display:flex;align-items:center;justify-content:center;gap:0.3em;width:100%}.config-input input,.config-input select{font-size:0.85em;padding:0.2em 0.3em}.start-btn-vertical{height:100%;min-width:130px;width:130px;background:linear-gradient(135deg,#28a745 0%,#20c997 100%);color:#fff;font-weight:bold;font-size:1.1em;border:none;border-radius:0;box-shadow:0 2px 8px rgba(0,0,0,0.2);cursor:pointer;letter-spacing:0.15em;transition:background 0.2s,box-shadow 0.2s,transform 0.1s;outline:none;display:flex;flex-direction:row;align-items:center;justify-content:center;margin:0;padding:0 1.2em 0 1.5em;gap:0.6em;position:absolute;right:0;top:0;bottom:0}.start-btn-vertical:hover,.start-btn-vertical:focus{background:linear-gradient(135deg,#34ce57 0%,#28efb5 100%);box-shadow:0 4px 16px rgba(0,0,0,0.25);transform:scale(1.03)}.bsod-container{display:flex;flex-direction:row;width:100vw;height:100vh}.bsod-box-left{width:50vw;min-width:350px;display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start;box-sizing:border-box;padding-left:7vw;padding-top:7vh}.bsod-box-right{width:50vw;min-width:200px;position:relative;display:flex;align-items:center;justify-content:center;min-height:100vh}.smiley{font-size:8vw;font-weight:200;margin-bottom:1vw;color:#fff;user-select:none;text-align:left}.main-message{max-width:50vw;width:100%;margin-bottom:0}.main-message p{font-size:2vw;color:#fff;font-weight:400;line-height:1.2;text-align:left;word-break:break-word}.main-message .secondary-message{display:block;font-size:1.2vw;font-weight:300;margin-top:0.8vw}.red-flag-emoji{font-size:1.2em;vertical-align:middle;color:#e53935;margin-left:0.15em;filter:drop-shadow(0 0 1px #fff)}.footer-row{width:100%;display:flex;flex-direction:row;align-items:flex-start;margin-top:0.5vw;margin-bottom:2vw;gap:1.5vw}.footer-left{flex:1 1 50%;display:flex;flex-direction:column;align-items:stretch}.footer-right{flex:1 1 50%;min-height:60px}.completion-text{font-size:1.6vw;font-weight:300;color:#fff;margin:0;text-align:left;white-space:nowrap;flex-shrink:0}.footer-inline{display:flex;flex-direction:row;align-items:center;gap:1vw;white-space:nowrap;justify-content:space-between;width:100%}.info-area{width:100%;display:flex;flex-direction:row;align-items:flex-start;justify-content:flex-start;margin-top:0 !important;margin-bottom:0;gap:1.5vw}.qr-section{display:flex;flex-direction:column;gap:0.5vw;width:100%}.qr-row{display:flex;flex-direction:row;align-items:flex-start;gap:1vw}.qr-image-block{flex-shrink:0}.qr-code{width:9.1vw;height:9.1vw;min-width:117px;min-height:117px;max-width:156px;max-height:156px;flex-shrink:0;border-radius:0;background:none;border:none;display:block}.qr-text-block{display:flex;flex-direction:column;gap:0.5vw;flex:1}.qr-description{font-size:0.95vw;font-weight:300;line-height:1.3;color:#fff}.qr-description p{margin:0;padding:0}.code-defaillance{font-size:1vw;font-weight:300;line-height:1.3;color:#fff}.code-defaillance p{margin:0;padding:0}.right-content{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center}.custom-message-display{position:absolute;top:40%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:2.5vw;font-weight:500;text-align:center;z-index:10;padding:1em;max-width:80%;word-wrap:break-word;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}.timer-display{position:absolute;top:10%;left:50%;transform:translateX(-50%);color:#fff;text-align:center;z-index:10;padding:0.8em;max-width:80%}.timer-label{font-size:1.5vw;font-weight:400;margin:0 0 0.3em 0;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}.timer-text{font-size:4vw;font-weight:700;margin:0;letter-spacing:0.1em;text-shadow:3px 3px 6px rgba(0,0,0,0.4);font-family:'Consolas','Courier New',monospace}.emoji-bg-preview{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:20vw;opacity:0.3;user-select:none;pointer-events:none;position:absolute;top:0;left:0;z-index:1;box-sizing:border-box}.reward-display{position:absolute;bottom:30%;left:50%;transform:translateX(-50%);color:#fff;text-align:center;z-index:10;padding:1em;max-width:80%}.reward-label{font-size:1.3vw;font-weight:600;margin:0 0 0.5em 0;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}.reward-text{font-size:2vw;font-weight:500;margin:0;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}#codeInput{padding:10px;width:180px;max-width:30vw;border:none;border-radius:4px;font-size:1.1vw;color:#222;background:#fff;outline:none}button{padding:10px 22px;background-color:#fff;color:#0078D7;border:none;border-radius:4px;cursor:pointer;font-size:1.1vw;font-weight:bold;transition:background-color 0.3s}button:hover{background-color:#e6e6e6}h1{font-size:2.5vw;font-weight:400;margin-top:0;margin-bottom:2vw;line-height:1.2;text-align:left;color:#fff}.content p{font-size:1.3vw;line-height:1.5;margin-bottom:1.2vw;font-weight:300;max-width:700px;text-align:left;color:#fff}#custom-message{margin-bottom:0.7vw}
</style> 
</head>
<body id="bodyFlag">
    <!-- Config Bar -->
    <div class="config-panel">
        <div class="config-bar-grid">
            <!-- Icône d'ambiance -->
            <div class="config-group">
                <div class="config-label"><label for="iconEmojiSelect">Icône</label></div>
                <div class="config-input">
                    <select id="iconEmojiSelect" style="width:120px;">
                        <option value="" selected>Aucun</option>
                        <option value="🚩">🚩 Flag</option>
                        <option value="😊">😊 Sourire</option>
                        <option value="😅">😅 Gêné</option>
                        <option value="😎">😎 Cool</option>
                        <option value="😬">😬 Embarrassé</option>
                        <option value="😘">😘 Bisou</option>
                        <option value="❤️">❤️ Cœur</option>
                        <option value="👮">👮 Policier</option>
                        <option value="🔒">🔒 Prison</option>
                        <option value="🎉">🎉 Fête</option>
                        <option value="☕">☕ Café</option>
                        <option value="🥐">🥐 Croissant</option>
                        <option value="🍫">🍫 Chocolat</option>
                        <option value="🍰">🍰 Gâteau</option>
                        <option value="🏆">🏆 Trophée</option>
                    </select>
                    <span id="iconEmojiPreview" style="font-size: 1.5em; margin-left:0.3em;"></span>
                </div>
            </div>
            <!-- Couleur principale -->
            <div class="config-group">
                <div class="config-label"><label for="mainColorInput">🎨 Couleur</label></div>
                <div class="config-input">
                    <input type="text" id="mainColorInput" value="#0078d7" maxlength="7" style="width:65px; text-transform:uppercase; font-size:0.85em;" />
                    <span id="colorPalette" style="display:flex; gap:3px; margin-left:0.3em;">
                        <button class="color-btn" data-color="#0078d7" title="Bleu" style="background:#0078d7; width:16px; height:16px; border:1px solid #ccc; cursor:pointer; border-radius:2px; padding:0;"></button>
                        <button class="color-btn" data-color="#e81123" title="Rouge" style="background:#e81123; width:16px; height:16px; border:1px solid #ccc; cursor:pointer; border-radius:2px; padding:0;"></button>
                        <button class="color-btn" data-color="#ff00ff" title="Magenta" style="background:#ff00ff; width:16px; height:16px; border:1px solid #ccc; cursor:pointer; border-radius:2px; padding:0;"></button>
                        <button class="color-btn" data-color="#00b300" title="Vert" style="background:#00b300; width:16px; height:16px; border:1px solid #ccc; cursor:pointer; border-radius:2px; padding:0;"></button>
                    </span>
                </div>
            </div>
            <!-- Pris en Flag par -->
            <div class="config-group">
                <div class="config-label"><label for="inputFlagger">🚩 Flag par</label></div>
                <div class="config-input"><input type="text" id="inputFlagger" placeholder="Nom" style="width:100%;" /></div>
            </div>
            <!-- Texte perso -->
            <div class="config-group">
                <div class="config-label"><input type="checkbox" id="toggleCustomText" checked /><label for="toggleCustomText" style="margin-left:0.3em;">💬 Message perso</label></div>
                <div class="config-input"><input type="text" id="inputCustomText" placeholder="Texte..." style="width:100%; min-width:150px;" /></div>
            </div>
            <!-- Récompense -->
            <div class="config-group">
                <div class="config-label"><label for="selectReward">🏆 Récompense</label></div>
                <div class="config-input">
                    <select id="selectReward" style="width:100%;">
                        <option value="" selected>Aucun</option>
                        <option value="☕ Café">☕ Café</option>
                        <option value="🥤 Boisson">🥤 Boisson</option>
                        <option value="🥐 Croissant">🥐 Croissant</option>
                        <option value="🍫 Chocolat">🍫 Chocolat</option>
                        <option value="� Bonbon">🍬 Bonbon</option>
                        <option value="�🍰 Gâteau">🍰 Gâteau</option>
                        <option value="🍕 Pizza">🍕 Pizza</option>
                        <option value="🍽️ Repas">🍽️ Repas</option>
                        <option value="🍺 Bière">🍺 Bière</option>
                        <option value="💋 Bisous">💋 Bisous</option>
                        <option value="🤗 Câlin">🤗 Câlin</option>
                        <option value="🤝 Service">🤝 Service</option>
                    </select>
                </div>
            </div>
            <!-- Verrouillage -->
            <div class="config-group">
                <div class="config-label"><input type="checkbox" id="toggleLock" /><label for="toggleLock" style="margin-left:0.3em;">🔒 Lock</label></div>
                <div class="config-input"><input type="text" id="inputSecurityCode" placeholder="Code" style="width:100%;" /></div>
            </div>
        </div>
        
        <!-- Bouton START -->
        <button class="start-btn-vertical" id="startBtn">
            <span style="font-weight: 900;">FLAG</span>
            <span style="font-size:1.4em;">🚩</span>
        </button>
    </div>
    
    <!-- Contenu principal BSoD -->
    <div class="bsod-container">
        <div class="bsod-box-left">
            <div class="smiley">:(</div>
            <div class="main-message">
                <p>
                    Votre ordinateur a rencontré un problème de sécurité et doit être débloqué.<br>
                    <span class="secondary-message">Votre session n'a pas été verrouillée. <b><span id="flaggerName1">Un collègue vigilant</span></b> a placé un <b>Flag <span class="red-flag-emoji">🚩</span></b> sur votre poste.<br>
                    Ceci est un exercice de sensibilisation.<br>
                    Pour débloquer, entrez le code de sécurité communiqué par <b><span id="flaggerName2">votre collègue</span></b>.</span>
                </p>
            </div>
            <div class="footer-row">
                <div class="footer-left">
                    <span class="completion-text">100% achevés</span>
                </div>
                <!-- Section pour déblocage AVEC code (quand lock activé) -->
                <div class="footer-right" id="unlockSection" style="display:none;">
                    <div class="footer-inline">
                        <input type="password" id="codeInput" placeholder="Code de sécurité..." autofocus>
                        <button onclick="checkCode()">DÉBLOQUER</button>
                    </div>
                </div>
            </div>
            <div class="info-area">
                <div class="qr-section">
                    <div class="qr-row">
                        <div class="qr-image-block">
                            <img src="img/qr_code.png" alt="QR Code" class="qr-code">
                        </div>
                        <div class="qr-text-block">
                            <div class="qr-description">
                                <p>Pour plus d'informations sur les bonnes pratiques de sécurité, scannez le code.</p>
                            </div>
                            <div class="code-defaillance">
                                <p>Code de défaillance : <b>OUBLIE_VERROUILLAGE</b></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bsod-box-right">
            <div class="right-content">
                <div id="timerDisplay" class="timer-display" style="display:none;">
                    <p class="timer-label">⏱️ Flaggé depuis</p>
                    <p id="timerText" class="timer-text">00:00</p>
                </div>
                <!-- Bouton pour déverrouillage SANS code (quand lock désactivé) -->
                <div id="simpleUnlockSection" style="display:none;position:absolute;top:28%;left:50%;transform:translateX(-50%);z-index:20;">
                    <button onclick="simpleUnlock()" style="background-color:#28a745;color:#fff;font-size:1.3vw;padding:15px 40px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;box-shadow:0 4px 15px rgba(0,0,0,0.3);transition:all 0.3s;" onmouseover="this.style.backgroundColor='#218838';this.style.transform='scale(1.05)';" onmouseout="this.style.backgroundColor='#28a745';this.style.transform='scale(1)';">🔓 Déverrouiller mon écran</button>
                </div>
                <p id="customMessageDisplay" class="custom-message-display"></p>
                <div id="emoji-bg-preview" class="emoji-bg-preview"></div>
                <div id="rewardDisplay" class="reward-display">
                    <p class="reward-label">Récompense attendue :</p>
                    <p id="rewardText" class="reward-text"></p>
                </div>
            </div>
        </div>
    </div>
    <script>
// Variables dynamiques pour la version 1.2
document.addEventListener('DOMContentLoaded', function() {
    // Variables globales
    let currentFlaggerName = 'votre collègue vigilant'; // Nom par défaut
    
    // Variables pour le timer
    let timerInterval = null;
    let startTime = null;
    const timerDisplay = document.getElementById('timerDisplay');
    const timerText = document.getElementById('timerText');
    
    // Fonction pour démarrer le chronomètre
    function startTimer() {
        if (timerInterval) return; // Empêche les multiples démarrages
        
        startTime = Date.now();
        if (timerDisplay) timerDisplay.style.display = 'block';
        
        timerInterval = setInterval(function() {
            const elapsed = Date.now() - startTime;
            const seconds = Math.floor(elapsed / 1000);
            const minutes = Math.floor(seconds / 60);
            const displaySeconds = seconds % 60;
            
            const formattedTime = 
                String(minutes).padStart(2, '0') + ':' + 
                String(displaySeconds).padStart(2, '0');
            
            if (timerText) timerText.textContent = formattedTime;
        }, 1000);
    }
    
    // Fonction pour arrêter le chronomètre
    function stopTimer() {
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        // Retourner le temps écoulé en secondes
        if (startTime) {
            return Math.floor((Date.now() - startTime) / 1000);
        }
        return 0;
    }
    
    // Fonction de déverrouillage simple (sans code)
    window.simpleUnlock = function() {
        // Arrêter le timer et récupérer le temps écoulé
        const unlockTime = stopTimer();
        
        // Sortir du mode plein écran
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
        
        // Afficher message de succès
        const flaggerNameElement = document.getElementById('flaggerName1');
        const currentName = flaggerNameElement ? flaggerNameElement.textContent : 'votre collègue vigilant';
        
        let successMessage = '✅ Écran déverrouillé\n\n';
        successMessage += `Signalé par : ${currentName}`;
        successMessage += `\n\nTemps écoulé : ${Math.floor(unlockTime / 60)}min ${unlockTime % 60}s`;
        
        showSuccessMessage(successMessage);
        
        // Fermeture après 3 secondes
        setTimeout(function() {
            window.close();
            setTimeout(function() {
                document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#28a745;color:#fff;font-family:Consolas,monospace;text-align:center;flex-direction:column;"><h1 style="font-size:3vw;margin-bottom:1em;">✅ Écran déverrouillé !</h1><p style="font-size:1.5vw;margin-bottom:2em;">Vous pouvez fermer cet onglet</p><p style="font-size:1.2vw;opacity:0.8;">(Appuyez sur Ctrl+W ou fermez l\'onglet manuellement)</p></div>';
            }, 100);
        }, 3000);
    };
    
    // START button logic
    const startBtn = document.getElementById('startBtn');
    const configPanel = document.querySelector('.config-panel');
    const simpleUnlockSection = document.getElementById('simpleUnlockSection');
    if (startBtn) {
        startBtn.addEventListener('click', function() {
            // Démarrer le chronomètre
            startTimer();
            
            // Plein écran
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.webkitRequestFullscreen) {
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) {
                document.documentElement.msRequestFullscreen();
            }
            // Masquer la config bar
            if (configPanel) configPanel.style.display = 'none';
            
            // Afficher le bon bouton de déverrouillage selon le mode lock
            if (toggleLock && toggleLock.checked) {
                // Lock activé : afficher section avec code
                if (unlockSection) unlockSection.style.display = 'block';
                if (simpleUnlockSection) simpleUnlockSection.style.display = 'none';
            } else {
                // Lock désactivé : afficher bouton simple
                if (unlockSection) unlockSection.style.display = 'none';
                if (simpleUnlockSection) simpleUnlockSection.style.display = 'block';
            }
        });
    }
    // Gestion de l'icône emoji
    const iconEmojiSelect = document.getElementById('iconEmojiSelect');
    const iconEmojiPreview = document.getElementById('iconEmojiPreview');
    const emojiBgPreview = document.getElementById('emoji-bg-preview');
    function setIconEmoji(val) {
        const emoji = val && val.trim() ? val.trim() : '';
        if (iconEmojiPreview) iconEmojiPreview.textContent = emoji;
        if (emojiBgPreview) {
            emojiBgPreview.textContent = emoji;
            // Si aucune icône, cacher complètement l'élément
            emojiBgPreview.style.display = emoji ? 'flex' : 'none';
        }
    }
    if (iconEmojiSelect) {
        iconEmojiSelect.addEventListener('change', function() {
            setIconEmoji(iconEmojiSelect.value);
        });
        // Valeur par défaut
        setIconEmoji(iconEmojiSelect.value);
    }
    // Gestion de la couleur principale
    const mainColorInput = document.getElementById('mainColorInput');
    const colorPalette = document.getElementById('colorPalette');
    const bsodContainer = document.querySelector('.bsod-container');
    
    function setMainColor(hex) {
        // Applique la couleur principale sur le body (ou root)
        document.documentElement.style.setProperty('--main-color', hex);
        if (mainColorInput) mainColorInput.value = hex.toUpperCase();
        // Applique au background de la page
        if (bsodContainer) {
            bsodContainer.style.backgroundColor = hex;
        }
        document.body.style.backgroundColor = hex;
    }
    // Palette boutons
    if (colorPalette) {
        colorPalette.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                setMainColor(this.getAttribute('data-color'));
            });
        });
    }
    // Champ hexadécimal
    if (mainColorInput) {
        mainColorInput.addEventListener('input', function() {
            const val = mainColorInput.value;
            if (/^#[0-9A-Fa-f]{6}$/.test(val)) {
                setMainColor(val);
            }
        });
        // Valeur par défaut
        setMainColor(mainColorInput.value);
    }
    const inputFlagger = document.getElementById('inputFlagger');
    const flaggerName1 = document.getElementById('flaggerName1');
    const flaggerName2 = document.getElementById('flaggerName2');
    const toggleCustomText = document.getElementById('toggleCustomText');
    const inputCustomText = document.getElementById('inputCustomText');
    const customMessageDisplay = document.getElementById('customMessageDisplay');
    const selectReward = document.getElementById('selectReward');
    const rewardDisplay = document.getElementById('rewardDisplay');
    const rewardText = document.getElementById('rewardText');
    const toggleLock = document.getElementById('toggleLock');
    const inputSecurityCode = document.getElementById('inputSecurityCode');
    const unlockSection = document.getElementById('unlockSection');
    
    // Nom du collègue
    if (inputFlagger) {
        inputFlagger.addEventListener('input', function() {
            const name = inputFlagger.value.trim();
            currentFlaggerName = name ? name : 'votre collègue vigilant'; // Mise à jour globale
            if (flaggerName1) {
                flaggerName1.textContent = name ? name : 'Un collègue vigilant';
            }
            if (flaggerName2) {
                flaggerName2.textContent = name ? name : 'votre collègue';
            }
            // Met à jour le titre de la page
            document.title = name ? `Pris en Flag par ${name}` : 'Pris en Flag';
        });
    }
    
    // Message personnalisé
    if (inputCustomText && customMessageDisplay) {
        inputCustomText.addEventListener('input', function() {
            const message = inputCustomText.value.trim();
            // Afficher seulement si le toggle est activé ET qu'il y a un message
            if (toggleCustomText && toggleCustomText.checked && message) {
                customMessageDisplay.textContent = message;
                customMessageDisplay.style.display = 'block';
            } else {
                customMessageDisplay.style.display = 'none';
            }
        });
    }
    
    // Toggle du message personnalisé
    if (toggleCustomText && customMessageDisplay && inputCustomText) {
        toggleCustomText.addEventListener('change', function() {
            if (toggleCustomText.checked) {
                // Activé : afficher le message s'il existe
                const message = inputCustomText.value.trim();
                if (message) {
                    customMessageDisplay.textContent = message;
                    customMessageDisplay.style.display = 'block';
                }
            } else {
                // Désactivé : masquer le message
                customMessageDisplay.style.display = 'none';
            }
        });
    }
    
    // Récompense
    if (selectReward && rewardDisplay && rewardText) {
        selectReward.addEventListener('change', function() {
            const reward = selectReward.value.trim();
            if (reward) {
                rewardText.textContent = reward;
                rewardDisplay.style.display = 'block';
            } else {
                rewardDisplay.style.display = 'none';
            }
        });
        // Initialisation (caché par défaut car "Aucun" est sélectionné)
        rewardDisplay.style.display = 'none';
    }
    
    // Initialisation du titre
    document.title = 'Pris en Flag';

    // Gestion du verrouillage
    function updateLockState() {
        if (toggleLock && toggleLock.checked) {
            // Lock activé : afficher le champ code et la section débloquer
            if (inputSecurityCode) {
                inputSecurityCode.style.display = '';
            }
            if (unlockSection) {
                unlockSection.style.display = '';
            }
        } else {
            // Lock désactivé : cacher le champ code et la section débloquer
            if (inputSecurityCode) {
                inputSecurityCode.style.display = 'none';
            }
            if (unlockSection) {
                unlockSection.style.display = 'none';
            }
        }
    }
    
    if (toggleLock) {
        toggleLock.addEventListener('change', updateLockState);
        // Initialisation (désactivé par défaut)
        updateLockState();
    }
});
// --- 🚩 CONFIGURATION IMPORTANTE (À MODIFIER) ---

// L'URL de votre futur serveur (Backend) qui enregistrera l'événement de Flag
const URL_SERVEUR_LOG = "http://votre-serveur/api/enregistrer_flag"; 

// --- VARIABLES GLOBALES ---

let expectedCode = "RECOMPENSE"; // Code par défaut si l'URL ne fournit pas de code
let flaggerName = "Un Collègue Vigilant"; // Nom par défaut

// --- FONCTIONS LOGIQUES ---

function getUrlParameters() {
    /** Récupère les paramètres de l'URL et met à jour le contenu/code secret **/
    const urlParams = new URLSearchParams(window.location.search);
    
    // 1. Définition du Code Secret
    if (urlParams.has('code')) {
        const code = urlParams.get('code').trim().toUpperCase();
        expectedCode = code;
        const codeInput = document.getElementById('inputSecurityCode');
        if (codeInput) {
            codeInput.value = code;
        }
    }
    
    // 2. Définition du Nom du Flagger (pour le message de reward)
    if (urlParams.has('flagger')) {
        const name = urlParams.get('flagger').trim();
        flaggerName = name;
        currentFlaggerName = name;
        const nameInput = document.getElementById('flaggerName');
        if (nameInput) {
            nameInput.value = name;
        }
        // Mise à jour des affichages
        const flaggerSpans = document.querySelectorAll('.flagger-name');
        flaggerSpans.forEach(span => {
            span.textContent = name;
        });
    }
    
    // 3. Mise à jour du Message personnalisé
    const customMessageElement = document.getElementById('custom-message');
    if (urlParams.has('msg') && customMessageElement) {
        const msg = decodeURIComponent(urlParams.get('msg')); 
        customMessageElement.innerHTML = msg;
        const msgInput = document.getElementById('customMessage');
        if (msgInput) {
            msgInput.value = msg;
        }
    }
    
    // 4. Définition de l'Icône emoji
    if (urlParams.has('icon')) {
        const icon = decodeURIComponent(urlParams.get('icon'));
        const iconSelect = document.getElementById('iconEmojiSelect');
        if (iconSelect) {
            iconSelect.value = icon;
            // Déclencher manuellement l'update
            const emojiBgPreview = document.getElementById('emojiBgPreview');
            if (emojiBgPreview) {
                emojiBgPreview.textContent = icon;
                emojiBgPreview.style.display = icon ? 'flex' : 'none';
            }
        }
    }
    
    // 5. Définition de la Couleur de fond
    if (urlParams.has('color')) {
        const color = urlParams.get('color').toLowerCase();
        const colorMap = {
            'blue': '#0078d7',
            'red': '#e81123',
            'magenta': '#ff00ff',
            'green': '#00b300'
        };
        
        let hexColor;
        if (colorMap[color]) {
            // Couleur prédéfinie
            hexColor = colorMap[color];
        } else if (color.startsWith('#')) {
            // Code HEX avec #
            hexColor = color;
        } else if (/^[0-9a-f]{6}$/i.test(color)) {
            // Code HEX sans #
            hexColor = '#' + color;
        }
        
        if (hexColor) {
            // Appliquer la couleur
            document.documentElement.style.setProperty('--main-color', hexColor);
            const bsodContainer = document.querySelector('.bsod-container');
            if (bsodContainer) {
                bsodContainer.style.backgroundColor = hexColor;
            }
            document.body.style.backgroundColor = hexColor;
            
            // Mettre à jour l'input
            const mainColorInput = document.getElementById('mainColorInput');
            if (mainColorInput) {
                mainColorInput.value = hexColor.toUpperCase();
            }
        }
    }
    
    // 6. Définition de la Récompense
    if (urlParams.has('reward')) {
        const reward = decodeURIComponent(urlParams.get('reward'));
        const rewardSelect = document.getElementById('selectReward');
        const rewardDisplay = document.getElementById('rewardDisplay');
        const rewardText = document.getElementById('rewardText');
        
        if (rewardSelect) {
            rewardSelect.value = reward;
            // Appliquer visuellement
            if (reward && rewardText) {
                rewardText.textContent = reward;
                if (rewardDisplay) {
                    rewardDisplay.style.display = 'block';
                }
            } else {
                if (rewardDisplay) {
                    rewardDisplay.style.display = 'none';
                }
            }
        }
    }
    
    // 7. Définition de l'État du Verrouillage
    if (urlParams.has('lock')) {
        const lockValue = urlParams.get('lock').toLowerCase();
        const lockToggle = document.getElementById('toggleLock');
        if (lockToggle) {
            lockToggle.checked = (lockValue === 'true' || lockValue === '1' || lockValue === 'on');
            updateLockState();
        }
    }
}


function enterFullscreen() {
    /** Tente de mettre la page en plein écran pour maximiser l'effet de blocage **/
    const body = document.getElementById('bodyFlag');
    // Tente de mettre en plein écran avec les différentes méthodes de navigateur
    if (body.requestFullscreen) {
        body.requestFullscreen();
    } else if (body.mozRequestFullScreen) {
        body.mozRequestFullScreen();
    } else if (body.webkitRequestFullscreen) { 
        body.webkitRequestFullscreen();
    } else if (body.msRequestFullscreen) { 
        body.msRequestFullscreen();
    }
}


function checkCode() {
    /** Vérifie le code entré par l'utilisateur ciblé **/
    const codeInput = document.getElementById('codeInput');
    const codeEntré = codeInput.value.trim().toUpperCase();
    
    // Récupérer le code de sécurité défini dans la config bar
    const inputSecurityCode = document.getElementById('inputSecurityCode');
    const securityCode = inputSecurityCode ? inputSecurityCode.value.trim().toUpperCase() : '';
    
    // Si un code est défini dans la config, l'utiliser
    // Sinon, si aucun code n'est défini (vide), accepter un code vide
    // Pour compatibilité URL, utiliser expectedCode seulement si pas de config bar
    let codeAttendu;
    if (inputSecurityCode) {
        // Config bar présente : utiliser le code configuré (même si vide)
        codeAttendu = securityCode;
    } else {
        // Pas de config bar (URL directe) : utiliser expectedCode
        codeAttendu = expectedCode;
    }

    // Vérification du code
    if (codeEntré === codeAttendu) { 
        // Code correct : Déblocage
        // Récupérer le nom du flagger et la récompense
        const flaggerNameElement = document.getElementById('flaggerName1');
        const currentName = flaggerNameElement ? flaggerNameElement.textContent : 'votre collègue vigilant';
        const rewardTextElement = document.getElementById('rewardText');
        const currentReward = rewardTextElement ? rewardTextElement.textContent : '';
        
        // Construire le message de succès
        let successMessage = '✅ Félicitations ! Code correct.\nSession débloquée.\n\n';
        successMessage += `Votre collègue : ${currentName}`;
        if (currentReward) {
            successMessage += `\nmérite son reward : ${currentReward}`;
        }
        
        // Afficher le message de succès
        showSuccessMessage(successMessage);
        
        // Fermeture après 3 secondes
        setTimeout(function() {
            window.close();
            setTimeout(function() {
                document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#28a745;color:#fff;font-family:Consolas,monospace;text-align:center;flex-direction:column;"><h1 style="font-size:3vw;margin-bottom:1em;">✅ Débloqué avec succès !</h1><p style="font-size:1.5vw;margin-bottom:2em;">Vous pouvez fermer cet onglet</p><p style="font-size:1.2vw;opacity:0.8;">(Appuyez sur Ctrl+W ou fermez l\'onglet manuellement)</p></div>';
            }, 100);
        }, 3000);

    } else {
        // Code incorrect : Afficher message sans sortir du plein écran
        // Récupérer le nom du flagger depuis la page
        const flaggerNameElement = document.getElementById('flaggerName1');
        const currentName = flaggerNameElement ? flaggerNameElement.textContent : 'votre collègue vigilant';
        
        // Créer un message d'erreur temporaire sur la page
        showErrorMessage(`❌ Code invalide. Contactez ${currentName}.`);
        
        codeInput.value = ''; 
        codeInput.focus();
    }
}

// Fonction pour afficher un message d'erreur sans alert (qui fait sortir du plein écran)
function showErrorMessage(message) {
    // Créer ou réutiliser un élément pour le message d'erreur
    let errorDiv = document.getElementById('errorMessage');
    if (!errorDiv) {
        errorDiv = document.createElement('div');
        errorDiv.id = 'errorMessage';
        errorDiv.style.position = 'fixed';
        errorDiv.style.top = '50%';
        errorDiv.style.left = '50%';
        errorDiv.style.transform = 'translate(-50%, -50%)';
        errorDiv.style.backgroundColor = 'rgba(232, 17, 35, 0.95)';
        errorDiv.style.color = '#fff';
        errorDiv.style.padding = '2em 3em';
        errorDiv.style.borderRadius = '8px';
        errorDiv.style.fontSize = '1.8vw';
        errorDiv.style.fontWeight = 'bold';
        errorDiv.style.zIndex = '10000';
        errorDiv.style.boxShadow = '0 8px 30px rgba(0,0,0,0.6)';
        errorDiv.style.textAlign = 'center';
        errorDiv.style.maxWidth = '80%';
        errorDiv.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        errorDiv.style.border = '3px solid #fff';
        document.body.appendChild(errorDiv);
    }
    
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    errorDiv.style.opacity = '0';
    errorDiv.style.transform = 'translate(-50%, -50%) scale(0.8)';
    
    // Animation d'apparition
    setTimeout(function() {
        errorDiv.style.opacity = '1';
        errorDiv.style.transform = 'translate(-50%, -50%) scale(1)';
    }, 10);
    
    // Masquer après 3 secondes avec animation
    setTimeout(function() {
        errorDiv.style.opacity = '0';
        errorDiv.style.transform = 'translate(-50%, -50%) scale(0.8)';
        setTimeout(function() {
            errorDiv.style.display = 'none';
        }, 300);
    }, 3000);
}

// Fonction pour afficher un message de succès (même style mais en vert)
function showSuccessMessage(message) {
    // Créer ou réutiliser un élément pour le message de succès
    let successDiv = document.getElementById('successMessage');
    if (!successDiv) {
        successDiv = document.createElement('div');
        successDiv.id = 'successMessage';
        successDiv.style.position = 'fixed';
        successDiv.style.top = '50%';
        successDiv.style.left = '50%';
        successDiv.style.transform = 'translate(-50%, -50%)';
        successDiv.style.backgroundColor = 'rgba(40, 167, 69, 0.95)'; // Vert
        successDiv.style.color = '#fff';
        successDiv.style.padding = '2em 3em';
        successDiv.style.borderRadius = '8px';
        successDiv.style.fontSize = '1.6vw';
        successDiv.style.fontWeight = 'bold';
        successDiv.style.zIndex = '10000';
        successDiv.style.boxShadow = '0 8px 30px rgba(0,0,0,0.6)';
        successDiv.style.textAlign = 'center';
        successDiv.style.maxWidth = '80%';
        successDiv.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        successDiv.style.border = '3px solid #fff';
        successDiv.style.whiteSpace = 'pre-line'; // Permet les retours à la ligne
        successDiv.style.lineHeight = '1.5';
        document.body.appendChild(successDiv);
    }
    
    successDiv.textContent = message;
    successDiv.style.display = 'block';
    successDiv.style.opacity = '0';
    successDiv.style.transform = 'translate(-50%, -50%) scale(0.8)';
    
    // Animation d'apparition
    setTimeout(function() {
        successDiv.style.opacity = '1';
        successDiv.style.transform = 'translate(-50%, -50%) scale(1)';
    }, 10);
    
    // Pas de masquage automatique - on laisse 3 secondes avant la fermeture de la page
}

// Fonction d'enregistrement commentée pour le test local.
/*
function enregistrerFlag(success, flagger) {
    // Envoie l'information de faute au serveur (asynchrone)
    const data = {
        timestamp: new Date().toISOString(), 
        statut: success ? "FLAGGED_SUCCESS" : "FLAGGED_FAILED",
        code_secret: expectedCode,
        flagger_name: flagger,
    };

    fetch(URL_SERVEUR_LOG, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    })
    .then(response => {
        console.log('Flag enregistré avec succès.');
    })
    .catch(error => {
        console.error('Erreur lors de l\'enregistrement du Flag:', error);
    });
}
*/


// --- DÉMARRAGE ET GESTION DES ÉVÉNEMENTS ---

window.onload = function() {
    getUrlParameters(); // Récupère les paramètres de l'URL
    enterFullscreen(); 
    document.getElementById('codeInput').focus();
    
    // Permet de valider en appuyant sur 'Entrée'
    document.getElementById('codeInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            checkCode();
        }
    });

    // Empêche le clic droit pour éviter l'accès facile aux outils de développement
    document.addEventListener('contextmenu', event => event.preventDefault());
};
</script> 
</body>
</html>